<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Ingenieur</title>
		<link rel="stylesheet" href="main.css" />
		<script src="jquery-3.6.0.min.js"></script>
	</head>
	<body>
		<header>
			<h1>Ingénieurs Agricols</h1>
			<div class="slider">
				<img class="slider-img" src="assets/1.jpg" alt="" />
				<img class="slider-img" src="assets/2.jpg" alt="" />
				<img class="slider-img" src="assets/3.jpg" alt="" />
				<img class="slider-img" src="assets/4.jpg" alt="" />
			</div>
		</header>
		<nav>
			<ul>
				<li>
					<a class="lien" href="#">Accueil</a>
				</li>
				<li>
					<a class="lien" href="#">Types d'agriculture</a>
					<div class="links">
						<ul class="type_agriculture">
							<li>
								<a href="#">l'agriculture conventionnelle</a>
							</li>
							<li><a href="#">l'agriculture biologique</a></li>
							<li><a href="#">l'agriculture durable</a></li>
							<li><a href="#">l'agriculture Raisonnée</a></li>
							<li><a href="#">l'agriculture Intégrée</a></li>
						</ul>
					</div>
				</li>
				<li>
					<a class="lien" href="#">Contact</a>
				</li>
			</ul>
		</nav>
		<main>
			<div class="container">
				<video autoplay loop muted>
					<source src="assets/Top Features in Android 11.mp4" />
				</video>
			</div>
			<section>
				<h2>Statistiques</h2>
				<div>
					<figure>
						<figcaption>Principale production végétales mondiales</figcaption>
						<table id="table-vgt" class="tableau">
							<thead>
								<th scope="col">Culture</th>
								<th scope="col">Superficie cultivé (1000 ha)</th>
								<th scope="col">Production totale (1000 tonnes)</th>
							</thead>
							<tbody></tbody>
							<tfoot>
								<tr id="total-vgt">
									<th>Total</th>
									<td>0</td>
									<td>0</td>
								</tr>
							</tfoot>
						</table>
					</figure>
					<figure>
						<figcaption>Principaux élévage mondiaux</figcaption>
						<table id="table-anm" class="tableau">
							<thead>
								<th scope="col">Espèce</th>
								<th scope="col">Nombre (1000 tetes)</th>
							</thead>
							<tbody></tbody>
							<tfoot>
								<tr id="total-anm">
									<th>Total</th>
									<td>0</td>
								</tr>
							</tfoot>
						</table>
					</figure>
				</div>
			</section>
			<section class="add">
				<h2 class="title">Ajouter une nouvelle ligne</h2>
				<form class="container">
					<select name="selectTable" id="selectTable">
						<option value="vegetables" selected>production végétales</option>
						<option value="animals">élévage mondiaux</option>
					</select>
					<div class="inputs show vgt">
						<input id="culture" type="text" placeholder="Culutre" />
						<input
							id="superficie"
							type="number"
							placeholder="Superficie cultivé"
						/>
						<input id="total" type="number" placeholder="Production totale" />
					</div>
					<div class="inputs anm">
						<input type="text" id="espece" placeholder="Espece" />
						<input type="number" id="number" placeholder="Nombre" />
					</div>
					<input type="submit" value="Ajouter" />
				</form>
			</section>
		</main>
		<footer>
			<a href="mailto:engineer@esi.dz">Contact-us</a>
		</footer>
		<script>
			let animals = [];
			let vegetables = [];

			const calcTotal = () => {
				let sumVgtCulitive = 0;
				let sumVgtTotal = 0;
				let sumAnmTotal = 0;
				$.each(vegetables, (index, vegetable) => {
					sumVgtCulitive += parseInt(vegetable.cultive);
					sumVgtTotal += parseInt(vegetable.total);
				});
				$.each(animals, (index, animal) => {
					sumAnmTotal += parseInt(animal.number);
				});
				$("#total-vgt td:nth-child(2)").html(sumVgtCulitive);
				$("#total-vgt td:nth-child(3)").html(sumVgtTotal);
				$("#total-anm td").html(sumAnmTotal);
			};
			calcTotal();

			$("form select").change((e) => {
				if (e.target.value === "vegetables") {
					$(".vgt").addClass("show");
					$(".anm").removeClass("show");
				} else {
					$(".vgt").removeClass("show");
					$(".anm").addClass("show");
				}
			});

			const createTable = () => {
				$("#table-anm tbody").empty();
				$("#table-vgt tbody").empty();

				$.each(animals, (index, animal) => {
					$("#table-anm tbody").append(
						`<tr>
							<th>${animal.name}</th>
							<td>${animal.number}</td>
						</tr>`
					);
				});
				$.each(vegetables, (index, vegetable) => {
					$("#table-vgt tbody").append(
						`<tr>
							<th>${vegetable.name}</th>
							<td>${vegetable.cultive}</td>
							<td>${vegetable.total}</td>
						</tr>`
					);
				});
				calcTotal();
			};

			const getProducts = () => {
				$.ajax({
					method: "GET",
					url: "produit.json",
					async: false,
				}).done(function (data) {
					vegetables = data.vegetables;
					animals = data.animals;
					createTable();
				});
			};

			getProducts();

			const addToProducts = () => {
				// fetch("produit.html", {
				// 	method: "POST",
				// 	headers: {
				// 		"Content-Type": "application/json; utf-8",
				// 	},
				// 	body: JSON.stringify({
				// 		name: "Pomme de terre",
				// 		cultive: "220417",
				// 		total: "220417",
				// 	}),
				// });
				$.ajax({
					method: "POST",
					url: "produit.json",
					headers: {
						"Content-Type": "application/json; utf-8",
					},
					data: {
						name: "Pomme de terre",
						cultive: "220417",
						total: "220417",
					},
					success: (data, status, xhr) => {
						console.log(data);
					},
				});
			};

			const addItem = (e) => {
				e.preventDefault();
				if ($("#selectTable").val() === "vegetables") {
					const name = $("#culture").val();
					const superficie = $("#superficie").val();
					const total = $("#total").val();
					vegetables.push({
						name: name,
						cultive: superficie,
						total: total,
					});
					$("#table-vgt tbody").append(`
						<tr>
							<th>${name}</th>
							<td>${superficie}</td>
							<td>${total}</td>	
						</tr>
					`);
				} else {
					const espece = $("#espece").val();
					const number = $("#number").val();
					animals.push({
						name: espece,
						number: number,
					});
					$("#table-anm tbody").append(`
						<tr>
							<th>${espece}</th>
							<td>${number}</td>
						</tr>
					`);
				}
				calcTotal();
			};
			$("form").submit(addItem);

			setInterval(function () {
				getProducts();
			}, 1000);
		</script>
	</body>
</html>
